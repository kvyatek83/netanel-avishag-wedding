<ng-container *ngIf="!isLoading; else loading" >
  <!-- Filter -->
  <div *transloco="let t;">
    <mat-form-field >
      <mat-label>{{ t('filter.filterType') }}</mat-label>
      <mat-select [formControl]="filterType">
        <mat-option *ngFor="let topping of displayedColumns" [value]="topping">
          {{ t('columns.'+topping) }}
        </mat-option>
      </mat-select>
    </mat-form-field>
    <mat-form-field appearance="fill">
      <mat-label>{{ t('filter.filterValue') }}</mat-label>
      <input matInput [formControl]="filterValue" />
    </mat-form-field>

    <button mat-raised-button (click)="openUploadFile()">Open dialog without animation</button>
  </div>

  <ng-container *transloco="let t; read: 'columns'">
    <table mat-table [dataSource]="dataSource" matSort>
      <!-- Define columns for data -->
      <ng-container
        *ngFor="let column of displayedColumns"
        [matColumnDef]="column"
      >
        <th mat-header-cell mat-sort-header *matHeaderCellDef>{{ t(column) }}</th>
        <td
          mat-cell
          *matCellDef="let element"
          [class.cell-changed]="isValueChanged(element, column)"
        >
          <span *ngIf="element.editing !== true">{{ element[column] !== undefined ? element[column] : '--'}}</span>
          <!-- build my component for edit cells -->
          <mat-form-field *ngIf="element.editing === true" appearance="outline">
            <mat-label>{{ column }}</mat-label>
            <input matInput [formControl]="guestFormControls[column]" />
          </mat-form-field>
        </td>
      </ng-container>
      <!-- Separate column for Edit button -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>{{ t('actions') }}</th>
        <ng-container *transloco="let t; read: 'actionsBtns'">
          <td mat-cell *matCellDef="let element">
            <ng-container *ngIf="element.editing === true">
              <button
                mat-button
                (click)="editRow(element, true)"
                [matTooltip]="t('save')"
              >
                <mat-icon class="actions-icons__edit">done_outline</mat-icon>
              </button>
              <button
                mat-button
                (click)="editRow(element, false)"
                [matTooltip]="t('cancel')"
              >
                <mat-icon class="actions-icons__edit">close_outline</mat-icon>
              </button>
            </ng-container>
            <ng-container *ngIf="element.editing !== true">
              <button
                mat-button
                [disabled]="editIsOn"
                (click)="revertChanges(element)"
                [matTooltip]="t('revert')"
              >
                <mat-icon class="actions-icons__edit">refresh_outline</mat-icon>
              </button>
              <button
                mat-button
                [disabled]="editIsOn"
                (click)="startEditGuestDetails(element)"
                [matTooltip]="t('edit')"
              >
                <mat-icon class="actions-icons__edit">edit_outline</mat-icon>
              </button>
            </ng-container>
          </td>
        </ng-container>
      </ng-container>
      <!-- Checkbox Column -->

      <ng-container matColumnDef="select">
        <th mat-header-cell *matHeaderCellDef>
          <mat-checkbox
            (change)="$event ? toggleAllRows() : null"
            [checked]="selection.hasValue() && isAllSelected()"
            [indeterminate]="selection.hasValue() && !isAllSelected()"
          >
          </mat-checkbox>
        </th>
        <td mat-cell *matCellDef="let row">
          <mat-checkbox
            (click)="$event.stopPropagation()"
            (change)="$event ? selection.toggle(row) : null"
            [checked]="selection.isSelected(row)"
          >
          </mat-checkbox>
        </td>
      </ng-container>
      <tr
        mat-header-row
        *matHeaderRowDef="displayedColumns.concat(['actions', 'select'])"
      ></tr>
      <tr
        mat-row
        *matRowDef="
          let row;
          columns: displayedColumns.concat(['actions', 'select'])
        "
      ></tr>
    </table>
  </ng-container>
  <mat-paginator
    [pageSizeOptions]="[10, 20]"
    aria-label="Select page of users"
  ></mat-paginator>
</ng-container>

<!-- Make loading spinners -->
<ng-template #loading> Loading... </ng-template>
